from typing import Dict, Any, List, Optional
from core.state import VictimRecoveryState

class DocumentGenerator:
    """í•„ìš” ì„œë¥˜ ìƒì„± ë° ì•ˆë‚´"""
    
    def generate_application_form_guide(self, state: VictimRecoveryState) -> str:
        """í”¼í•´êµ¬ì œì‹ ì²­ì„œ ì‘ì„± ê°€ì´ë“œ"""
        
        return f"""ğŸ“ **í”¼í•´êµ¬ì œì‹ ì²­ì„œ ì‘ì„± ê°€ì´ë“œ**

**ê¸°ë³¸ ì •ë³´**
â€¢ ì„±ëª…: (ë³¸ì¸ ì„±ëª…)
â€¢ ì£¼ì†Œ: (ì£¼ë¯¼ë“±ë¡ìƒ ì£¼ì†Œ)
â€¢ ì—°ë½ì²˜: (ì—°ë½ ê°€ëŠ¥í•œ ë²ˆí˜¸)
â€¢ ì´ë©”ì¼: (ìˆëŠ” ê²½ìš°)

**í”¼í•´ ì •ë³´**
â€¢ í”¼í•´ ë°œìƒì¼: {state.get('damage_date', 'ë¯¸í™•ì¸')}
â€¢ í”¼í•´ ê¸ˆì•¡: {self._format_amount(state.get('damage_amount', 0))}
â€¢ ì‚¬ê¸°ë²” ê³„ì¢Œ: {state.get('scammer_account', 'í™•ì¸ í•„ìš”')}
â€¢ ì´ì²´ ë°©ë²•: {state.get('transfer_method', 'í™•ì¸ í•„ìš”')}

**í”¼í•´ ê²½ìœ„**
â€¢ ì‚¬ê¸°ë²”ì´ ì–´ë–»ê²Œ ì ‘ê·¼í–ˆëŠ”ì§€
â€¢ ì–´ë–¤ ê¸°ê´€ì„ ì‚¬ì¹­í–ˆëŠ”ì§€
â€¢ ì†¡ê¸ˆí•˜ê²Œ ëœ ê²½ìœ„
â€¢ í”¼í•´ë¥¼ ì•Œê²Œ ëœ ì‹œì 

**ì²¨ë¶€ ì„œë¥˜**
â€¢ ì‚¬ê±´ì‚¬ê³ ì‚¬ì‹¤í™•ì¸ì› (ê²½ì°°ì„œ ë°œê¸‰)
â€¢ ì‹ ë¶„ì¦ ì‚¬ë³¸
â€¢ ê³„ì¢Œ ì´ì²´ ë‚´ì—­ì„œ
â€¢ í†µí™” ë…¹ìŒ íŒŒì¼ (ìˆëŠ” ê²½ìš°)

**ì‘ì„± ì‹œ ì£¼ì˜ì‚¬í•­**
â€¢ ëª¨ë“  í•­ëª©ì„ ì •í™•íˆ ê¸°ì¬
â€¢ í—ˆìœ„ ê¸°ì¬ ì‹œ í˜•ì‚¬ì²˜ë²Œ ê°€ëŠ¥
â€¢ ë³¸ì¸ ì„œëª… í•„ìˆ˜

ì€í–‰ ë°©ë¬¸ ì‹œ ì°½êµ¬ì—ì„œ ì–‘ì‹ì„ ë°›ì•„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."""
    
    def generate_document_checklist(self, state: VictimRecoveryState) -> str:
        """ì„œë¥˜ ì²´í¬ë¦¬ìŠ¤íŠ¸"""
        
        required = [
            "ì‚¬ê±´ì‚¬ê³ ì‚¬ì‹¤í™•ì¸ì› (ê²½ì°°ì„œ ë°œê¸‰)",
            "ì‹ ë¶„ì¦ ì‚¬ë³¸", 
            "í”¼í•´êµ¬ì œì‹ ì²­ì„œ (ì€í–‰ ì œê³µ)",
            "ê³„ì¢Œì´ì²´ ë‚´ì—­ì„œ"
        ]
        
        optional = [
            "í†µí™” ë…¹ìŒ íŒŒì¼",
            "ë¬¸ì ë©”ì‹œì§€ ìº¡ì²˜",
            "ì‚¬ê¸°ë²”ê³¼ì˜ ëŒ€í™” ê¸°ë¡",
            "í”¼í•´ ìƒí™© ì„¤ëª…ì„œ"
        ]
        
        checklist = "ğŸ“‹ **ì„œë¥˜ ì²´í¬ë¦¬ìŠ¤íŠ¸**\n\n**í•„ìˆ˜ ì„œë¥˜** âœ…\n"
        for i, doc in enumerate(required, 1):
            status = "âœ…" if doc in state.get('submitted_documents', []) else "â­"
            checklist += f"{status} {i}. {doc}\n"
        
        checklist += "\n**ì„ íƒ ì„œë¥˜** (ë„ì›€ì´ ë¨)\n"
        for i, doc in enumerate(optional, 1):
            status = "âœ…" if doc in state.get('submitted_documents', []) else "ğŸ“"
            checklist += f"{status} {i}. {doc}\n"
        
        checklist += "\n**ì œì¶œ ë°©ë²•**\n"
        checklist += "â€¢ ì€í–‰ ì§€ì  ë°©ë¬¸ (ê¶Œì¥)\n"
        checklist += "â€¢ ì˜¨ë¼ì¸ ì—…ë¡œë“œ (ì€í–‰ë³„ ìƒì´)\n"
        checklist += "â€¢ ìš°í¸ ì œì¶œ (ì‚¬ë³¸ë§Œ ê°€ëŠ¥)\n"
        
        return checklist
    
    def generate_police_report_guide(self) -> str:
        """ê²½ì°°ì„œ ì‹ ê³  ê°€ì´ë“œ"""
        
        return """ğŸ›ï¸ **ê²½ì°°ì„œ ì‹ ê³  ì™„ë²½ ê°€ì´ë“œ**

**ë°©ë¬¸ ì „ ì¤€ë¹„**
â€¢ ì‹ ë¶„ì¦ ì§€ì°¸
â€¢ í”¼í•´ ìƒí™© ì •ë¦¬ (ì‹œê°„ìˆœ)
â€¢ ì‚¬ê¸°ë²” ì—°ë½ì²˜/ê³„ì¢Œë²ˆí˜¸
â€¢ ì´ì²´ ë‚´ì—­ ì¶œë ¥

**ì‹ ê³  ì ˆì°¨**
1. ê°€ê¹Œìš´ ê²½ì°°ì„œ ë°©ë¬¸
2. ë¯¼ì›ì‹¤ì—ì„œ "ë³´ì´ìŠ¤í”¼ì‹± í”¼í•´ ì‹ ê³ " ë§ì”€
3. ìˆ˜ì‚¬ê´€ê³¼ ìƒë‹´
4. í”¼í•´ ì‹ ê³ ì„œ ì‘ì„±
5. ì‚¬ê±´ì‚¬ê³ ì‚¬ì‹¤í™•ì¸ì› ë°œê¸‰ ìš”ì²­

**ì‹ ê³  ì‹œ ì„¤ëª…í•  ë‚´ìš©**
â€¢ ì–¸ì œ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì—°ë½ì´ ì™”ëŠ”ì§€
â€¢ ìƒëŒ€ë°©ì´ ì–´ë–¤ ê¸°ê´€ì„ ì‚¬ì¹­í–ˆëŠ”ì§€  
â€¢ ì–´ë–¤ ì´ìœ ë¡œ ëˆì„ ë³´ë‚´ê²Œ ë˜ì—ˆëŠ”ì§€
â€¢ í”¼í•´ë¥¼ ì•Œê²Œ ëœ ê²½ìœ„
â€¢ í˜„ì¬ê¹Œì§€ ì·¨í•œ ì¡°ì¹˜

**ë°œê¸‰ë°›ì„ ì„œë¥˜**
â€¢ ì‚¬ê±´ì‚¬ê³ ì‚¬ì‹¤í™•ì¸ì› (ì€í–‰ ì œì¶œìš©)
â€¢ ì‚¬ê±´ë²ˆí˜¸ ë©”ëª¨
â€¢ ë‹´ë‹¹ ìˆ˜ì‚¬ê´€ ì—°ë½ì²˜

**ì†Œìš” ì‹œê°„**
â€¢ ì¼ë°˜ì ìœ¼ë¡œ 1-2ì‹œê°„
â€¢ ë³µì¡í•œ ê²½ìš° ì¶”ê°€ ì‹œê°„ í•„ìš”

**ì£¼ì˜ì‚¬í•­**
â€¢ ì •í™•í•œ ì‚¬ì‹¤ë§Œ ì§„ìˆ 
â€¢ ì¶”ì¸¡ì´ë‚˜ ì¶”ì •ì€ ë³„ë„ í‘œì‹œ
â€¢ ê´€ë ¨ ì¦ê±° ìë£Œ ëª¨ë‘ ì œì¶œ

ì‹ ê³  ì™„ë£Œ í›„ ë°”ë¡œ ì€í–‰ì— ë°©ë¬¸í•˜ì‹œë©´ ë©ë‹ˆë‹¤."""

    def _format_amount(self, amount: Optional[int]) -> str:
        """ê¸ˆì•¡ í¬ë§·íŒ…"""
        if not amount:
            return "í™•ì¸ í•„ìš”"
        
        if amount >= 100000000:
            return f"{amount // 100000000}ì–µ {(amount % 100000000) // 10000}ë§Œì›"
        elif amount >= 10000:
            return f"{amount // 10000}ë§Œì›"
        else:
            return f"{amount:,}ì›"